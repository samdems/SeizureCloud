; PHP Configuration for File Uploads
; This file contains recommended PHP settings for handling file uploads up to 10MB
;
; INSTALLATION:
; 1. Copy this file or add these settings to your php.ini
;    Locations:
;    - Ubuntu/Debian: /etc/php/8.2/fpm/php.ini and /etc/php/8.2/cli/php.ini
;    - CentOS/RHEL: /etc/php.ini
;    - Docker: Mount as /usr/local/etc/php/conf.d/uploads.ini
;
; 2. After changes, restart PHP-FPM:
;    sudo systemctl restart php8.2-fpm
;    or for Apache:
;    sudo systemctl restart apache2
;
; 3. Verify changes:
;    php -i | grep upload_max_filesize
;    php -i | grep post_max_size

; =============================================================================
; FILE UPLOAD SETTINGS
; =============================================================================

; Maximum size of uploaded files
; Set to at least 2x your expected max file size for safety
upload_max_filesize = 20M

; Maximum size of POST data
; Must be larger than upload_max_filesize to account for other form data
post_max_size = 25M

; Enable file uploads
file_uploads = On

; Maximum number of files that can be uploaded via a single request
max_file_uploads = 20

; =============================================================================
; EXECUTION TIME SETTINGS
; =============================================================================

; Maximum execution time of each script (in seconds)
; Large file uploads need more time
max_execution_time = 300

; Maximum time for parsing input data (in seconds)
; Should be equal to or greater than max_execution_time
max_input_time = 300

; Maximum input variable nesting level
max_input_nesting_level = 64

; Maximum number of input variables allowed
max_input_vars = 1000

; =============================================================================
; MEMORY SETTINGS
; =============================================================================

; Maximum amount of memory a script may consume
; Should be at least 3-4x the upload_max_filesize to handle processing
memory_limit = 256M

; =============================================================================
; SESSION SETTINGS (Important for CSRF tokens during long uploads)
; =============================================================================

; Session cache expiration (in minutes)
session.gc_maxlifetime = 21600

; Session cookie lifetime (0 = until browser closes)
session.cookie_lifetime = 21600

; =============================================================================
; ERROR REPORTING (Adjust for production vs development)
; =============================================================================

; Development settings (detailed errors):
; display_errors = On
; display_startup_errors = On
; error_reporting = E_ALL

; Production settings (log errors, don't display):
display_errors = Off
display_startup_errors = Off
error_reporting = E_ALL & ~E_DEPRECATED & ~E_STRICT
log_errors = On
error_log = /var/log/php_errors.log

; =============================================================================
; OUTPUT BUFFERING
; =============================================================================

; Output buffering helps with large responses
output_buffering = 4096

; =============================================================================
; SECURITY SETTINGS
; =============================================================================

; Disable dangerous functions
disable_functions = exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source

; Hide PHP version
expose_php = Off

; Ensure session data is secure
session.cookie_httponly = On
session.cookie_secure = On
session.cookie_samesite = Lax

; =============================================================================
; OPCACHE SETTINGS (Recommended for production)
; =============================================================================

opcache.enable = 1
opcache.memory_consumption = 128
opcache.interned_strings_buffer = 8
opcache.max_accelerated_files = 10000
opcache.revalidate_freq = 60
opcache.fast_shutdown = 1

; =============================================================================
; REALPATH CACHE
; =============================================================================

; Increase realpath cache for better performance
realpath_cache_size = 4096K
realpath_cache_ttl = 600

; =============================================================================
; NOTES
; =============================================================================
;
; For Docker deployments, create this as a custom ini file:
;
; Dockerfile:
;   COPY php-upload-config.ini /usr/local/etc/php/conf.d/uploads.ini
;
; Or in docker-compose.yml:
;   volumes:
;     - ./config-examples/php-upload-config.ini:/usr/local/etc/php/conf.d/uploads.ini:ro
;
; For shared hosting:
;   - You may not have access to php.ini
;   - Try creating a .user.ini file in your project root with these settings
;   - Contact your hosting provider if limits can't be changed
;
; Testing your configuration:
;   1. Create a phpinfo.php file in your public directory:
;      <?php phpinfo(); ?>
;   2. Access it via browser: https://yourdomain.com/phpinfo.php
;   3. Search for the settings above to verify they're applied
;   4. DELETE the phpinfo.php file after testing (security risk)
;
; Troubleshooting:
;   - If changes don't take effect, check you're editing the correct php.ini
;   - Use: php --ini to see which files are loaded
;   - FPM and CLI may use different php.ini files
;   - Always restart PHP-FPM after making changes
;
; Performance considerations:
;   - These settings use more memory and CPU
;   - Monitor server resources after deployment
;   - Adjust values based on your server capacity
;   - Consider using a queue for very large file processing
